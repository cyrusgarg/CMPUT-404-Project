<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }}</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/PostDetail.css' %}">
</head>
<body>
    <h1>{{ post.title }}</h1>
    
    <!-- Display post metadata -->
    <p><strong>Description:</strong> {{ post.description }}</p>
    <p class="content"><strong>Content:</strong> {{ post.content }}</p>
    <p><strong>Published:</strong> {{ post.published }}</p>
    <p><strong>Visibility:</strong> {{ post.visibility }}</p>

    <!-- display images -->
    {% if post.image %}
        <img src="{{ post.image }}" alt="{{ post.title }} Image" style="max-width: 100%;">
    {% else %}
        <p><em>No image available for this post.</em></p>
    {% endif %}

    <!-- Like button (only if logged in) -->
    {% if is_logged_in %}
    <form action="{% url 'posts:like_post' post.id %}" method="POST">
        {% csrf_token %}
        <button type="submit" 
                class="like-button {% if is_liked %}liked{% else %}unliked{% endif %}">
            {% if is_liked %}
                Unlike
            {% else %}
                Like
            {% endif %}
            ({{ post.likes.count }})
        </button>
    </form>
    {% endif %}

    <a href="{% url 'posts:post_likes' post.id %}" class="likes-list-button">
        View Likes ({{ post.likes.count }})
    </a>
    
    <!-- Comment form (only if logged in) -->
    {% if is_logged_in %}
    <form id="comment-form" action="{% url 'posts:add_comment' post.id %}" method="POST" class="comment-form">
        {% csrf_token %}
        <label for="comment-content">Comment:</label>
        <textarea id="comment-content" name="content" required></textarea>
        <button type="submit">Add Comment</button>
    </form>
    {% endif %}

    <!-- Comment list -->
    <h2>Comments</h2>
    <ul id="comment-list">
        {% for comment in comments %}
            <li data-comment-id="{{ comment.id }}">
                {% if comment.user.author_profile %}
                    <strong>
                        <a href="{% url 'identity:author-profile' author_id=comment.user.author_profile.author_id %}">
                            {{ comment.user.author_profile.display_name }}
                        </a>
                    </strong>
                {% else %}
                    <strong>{{ comment.user.username }}</strong>
                {% endif %}
                : {{ comment.content }}
                <p>Likes: <span class="like-count">{{ comment.like_count }}</span></p>
                <!-- Like button for comment (only if logged in) -->
                {% if is_logged_in %}
                <form action="{% url 'posts:like_comment' post.id comment.id %}" method="POST" class="like-comment-form">
                    {% csrf_token %}
                    <button type="submit" class="like-button {% if comment.is_liked_by_user %}liked{% else %}unliked{% endif %}">
                        {% if comment.is_liked_by_user %}Liked{% else %}Like{% endif %}
                    </button>
                </form>
                {% endif %}
            </li>
        {% empty %}
            <li><em>No comments yet.</em></li>
        {% endfor %}
    </ul>    

    <!-- Back to posts list -->
    <a href="{% url 'posts:index' %}">Back to Posts</a>
    
    <!-- Include any necessary scripts -->
    {% if post.contentType == "text/markdown" %}
        <script src="{% static 'markdown-renderer.min.js' %}"></script>
    {% endif %}
</body>
</html>